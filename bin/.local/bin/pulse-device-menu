#!/bin/sh
# Menu for configuring PulseAudio input/output devices.
# Based on https://github.com/polybar/polybar-scripts.

outputs() {
    outputs=$(pactl list short sinks | cut -f2)
    output=$(echo "$outputs" | dmenu -i -p 'Output device')
    if [ -z "$output" ]; then
        exit
    fi
    pactl set-default-sink "$output" >/dev/null 2>&1

    # NOTE: Cannot substitute `pacmd` with `pactl` for this.
    apps=$(pacmd list-sink-inputs | awk '/index:/ {print $2}')
    for playing in $apps; do
        pactl move-sink-input "$playing" "$output" >/dev/null 2>&1
    done
}
    done
}

inputs() {
    inputs=$(pactl list short sources | awk '/input/ {print $2}')
    input=$(echo "$inputs" | dmenu -i -p 'Input device')
    if [ -z "$input" ]; then
        exit
    fi
    pactl set-default-source "$input" >/dev/null 2>&1

    # NOTE: Cannot substitute with `pactl`.
    apps=$(pacmd list-source-outputs | awk '/index:/ {print $2}')
    for recording in $apps; do
        pactl move-source-output "$recording" "$input" >/dev/null 2>&1
    done
}

    done
}

case $(echo "$output_prompt|$input_prompt|$mute_prompt" | rofi -sep "|" -dmenu -i -p "PulseAudio") in
    $output_prompt)
output_prompt='Change output device'
input_prompt='Change input device'
mute_prompt='(Un)mute audio'
case "$choice" in
    "$output_prompt")
        outputs
        ;;
    "$input_prompt")
        inputs
        ;;
    "$mute_prompt")
        pulseaudio-ctl mute
        ;;
esac
