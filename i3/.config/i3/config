# i3 config file (v4)
# Should you change your keyboard layout some time, delete
# this file and re-run i3-config-wizard(1).
# Please see http://i3wm.org/docs/userguide.html for a complete reference!

# Dependencies:
# i3-gaps
# rofi
# polybar
# picom
# dunst
# xbacklight
# playerctl
# pulseaudio-ctl
# feh
# python-pywal
# wpgtk-git
# terminus-font-ttf
# ttf-symbola
# nerd-fonts-fira-mono
# ttf-font-awesome
# noto-fonts-cjk
# betterlockscreen
# xautolock

# Font.
font bitmap 13

# Mod1 = Alt, Mod4 = Super (Alt conflicts with Vim).
set $mod Mod4
set $alt Mod1

set $left h
set $down j
set $up k
set $right l

# Use Mouse+$mod to drag floating windows to their wanted position.
floating_modifier $mod

# Kill focused window.
bindsym $mod+q kill

# Start the application launcher.
set $dmenu rofi -combi-modi drun#run -show combi -show-icons
bindsym $mod+d split v; exec $dmenu
bindsym $mod+Shift+d split h; exec $dmenu
# Switch between open applications.
bindsym $mod+Tab exec rofi -show window -show-icons
# Application hotkeys.
bindsym $mod+Return split v; exec --no-startup-id i3-sensible-terminal
bindsym $mod+Shift+Return split h; exec --no-startup-id i3-sensible-terminal
bindsym $mod+i split v; exec --no-startup-id $BROWSER
bindsym $mod+Shift+i split h; exec --no-startup-id $BROWSER
bindsym $mod+n split v; exec --no-startup-id $VISUAL
bindsym $mod+Shift+n split h; exec --no-startup-id $VISUAL
bindsym $mod+e split v; exec open-menu
bindsym $mod+Shift+e split h; exec open-menu

# Change focus.
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right

# Move focused window.
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right

# Swithc to vertically stacked splits.
bindsym $mod+v split v
# Switch to horizontally stacked splits.
bindsym $mod+Shift+v split h

# Toggle fullscreen.
bindsym $mod+f fullscreen toggle

# Toggle sticky.
bindsym $mod+s sticky toggle
# Change container layout.
set $mode_layout "Layout: [w] tabbed [s]tacking [e] toggle split [q]uit"
bindsym $mod+w mode $mode_layout
mode $mode_layout {
    bindsym w layout tabbed; mode "default"
    bindsym s layout stacking; mode "default"
    bindsym e layout toggle split; mode "default"
    bindsym q mode "default"
    bindsym Control+bracketleft mode "default"
    bindsym Escape mode "default"
    bindsym Return mode "default"
}

# Toggle tiling/floating.
bindsym $mod+Shift+space floating toggle

# Change focus between tiling/floating windows.
bindsym $mod+space focus mode_toggle

# Focus the parent container.
bindsym $mod+a focus parent

# Focus the child container.
bindsym $mod+Shift+a focus child

# Move to scratchpad.
bindsym $mod+Shift+minus move scratchpad

# Cycle through scratchpad windows.
bindsym $mod+minus scratchpad show
bindsym XF86Search scratchpad show

# Marks.
bindsym $mod+m exec --no-startup-id i3-input -F 'mark %s' -l 1 -P 'Mark: '
bindsym $mod+quote exec --no-startup-id i3-input -F '[con_mark="%s"] focus' -P 'Mark: '
bindsym $mod+Shift+quote exec --no-startup-id i3-input -F 'swap container with mark %s' -P 'Mark: '

# Workspaces.
set $ws1 "1:I"
set $ws2 "2:II"
set $ws3 "3:III"
set $ws4 "4:IV"
set $ws5 "5:V"
set $ws6 "6:VI"
set $ws7 "7:VII"
set $ws8 "8:VIII"
set $ws9 "9:IX"
set $ws10 "10:X"

# Switch to workspace.
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws10
bindsym $alt+Tab workspace next
bindsym $alt+Shift+Tab workspace prev
bindsym Control+$alt+Down workspace next
bindsym Control+$alt+Up workspace prev

workspace_auto_back_and_forth yes

# Move to workspace.
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9
bindsym $mod+Shift+0 move container to workspace $ws10
bindsym $mod+Control+Shift+1 move container to workspace $ws1; workspace $ws1
bindsym $mod+Control+Shift+2 move container to workspace $ws2; workspace $ws2
bindsym $mod+Control+Shift+3 move container to workspace $ws3; workspace $ws3
bindsym $mod+Control+Shift+4 move container to workspace $ws4; workspace $ws4
bindsym $mod+Control+Shift+5 move container to workspace $ws5; workspace $ws5
bindsym $mod+Control+Shift+6 move container to workspace $ws6; workspace $ws6
bindsym $mod+Control+Shift+7 move container to workspace $ws7; workspace $ws7
bindsym $mod+Control+Shift+8 move container to workspace $ws8; workspace $ws8
bindsym $mod+Control+Shift+9 move container to workspace $ws9; workspace $ws9
bindsym $mod+Control+Shift+0 move container to workspace $ws10; workspace $ws10

# Reload configuration file.
bindsym $mod+r reload
# Restart i3 in-place (preserves session).
bindsym $mod+Shift+r restart

# Log out.
bindsym $mod+Shift+q exec power-menu

# Resize the window.
set $resize_delta 3
bindsym $mod+Control+$left resize grow left $resize_delta px or $resize_delta ppt
bindsym $mod+Control+$down resize grow down $resize_delta px or $resize_delta ppt
bindsym $mod+Control+$up resize grow up $resize_delta px or $resize_delta ppt
bindsym $mod+Control+$right resize grow right $resize_delta px or $resize_delta ppt
bindsym $mod+Control+Shift+$left resize shrink right $resize_delta px or $resize_delta ppt
bindsym $mod+Control+Shift+$down resize shrink up $resize_delta px or $resize_delta ppt
bindsym $mod+Control+Shift+$up resize shrink down $resize_delta px or $resize_delta ppt
bindsym $mod+Control+Shift+$right resize shrink left $resize_delta px or $resize_delta ppt
bindsym $mod+Up resize grow height $resize_delta px or $resize_delta ppt
bindsym $mod+Down resize shrink height $resize_delta px or $resize_delta ppt
bindsym $mod+Left resize shrink width $resize_delta px or $resize_delta ppt
bindsym $mod+Right resize grow width $resize_delta px or $resize_delta ppt

# Hide titlebar.
default_border pixel 2

# Steam window glitches: https://github.com/ValveSoftware/steam-for-linux/issues/1040.
for_window [class="^Steam$" title="^Friends$"] floating enable
for_window [class="^Steam$" title="Steam - News"] floating enable
for_window [class="^Steam$" title=".* - Chat"] floating enable
for_window [class="^Steam$" title="^Settings$"] floating enable
for_window [class="^Steam$" title=".* - event started"] floating enable
for_window [class="^Steam$" title=".* CD key"] floating enable
for_window [class="^Steam$" title="^Steam - Self Updater$"] floating enable
for_window [class="^Steam$" title="^Screenshot Uploader$"] floating enable
for_window [class="^Steam$" title="^Steam Guard - Computer Authorization Required$"] floating enable
for_window [title="^Steam Keyboard$"] floating enable

# Gaps.
set $default_inner 25
set $default_outer 0
set $gap_delta 2
gaps inner $default_inner
gaps outer $default_outer
set $mode_gaps "Gaps: [j] -outer [k] +outer [J] -inner [K] +inner [0] none [=] default [q]uit"
bindsym $mod+g mode $mode_gaps
mode $mode_gaps {
    bindsym j gaps outer all minus $gap_delta
    bindsym k gaps outer all plus $gap_delta
    bindsym Shift+j gaps inner all minus $gap_delta
    bindsym Shift+k gaps inner all plus $gap_delta
    bindsym 0 gaps inner all set 0; gaps outer all set 0
    bindsym equal gaps outer all set $default_outer; gaps inner all set $default_inner
    bindsym q mode "default"
    bindsym Control+bracketleft mode "default"
    bindsym Escape mode "default"
    bindsym Return mode "default"
}

# Colours.
set_from_resource $fg i3wm.color7 #f0f0f0
set_from_resource $bg i3wm.color0 #f0f0f0
set_from_resource $main i3wm.color2 #f0f0f0
set_from_resource $altc i3wm.color1 #f0f0f0
set_from_resource $alert i3wm.color5 #f0f0f0
# Only child_border actually matters.
# <colorclass>		<border>	<bg>	<text>	<indicator>	<child_border>
client.focused		$main		$main	$fg	$fg        	$main
client.focused_inactive	$altc		$main	$fg	$altc		$altc
client.unfocused	$altc		$altc	$fg	$altc		$altc
client.urgent		$alert		$alert	$bg	$altc		$alert
client.placeholder	NULL		$bg	$fg	NULL		$altc
client.background $bg

# Xbindkeys candidates.
# Volume keys.
bindsym XF86AudioRaiseVolume exec --no-startup-id vol up
bindsym XF86AudioLowerVolume exec --no-startup-id vol down
bindsym XF86AudioMute exec --no-startup-id vol mute

# Media keys.
bindsym XF86AudioPlay exec --no-startup-id playerctl play-pause
bindsym XF86AudioPause exec --no-startup-id playerctl pause
bindsym XF86AudioNext exec --no-startup-id playerctl next
bindsym XF86AudioPrev exec --no-startup-id playerctl previous

# Brightness keys.
set $brightness_delta 5
bindsym XF86MonBrightnessUp exec --no-startup-id brightness -inc $brightness_delta
bindsym XF86MonBrightnessDown exec --no-startup-id brightness -dec $brightness_delta

# Lock screen.
bindsym Control+$alt+l exec --no-startup-id lock

# Autostart.
exec --no-startup-id xautolock -time 30 -locker "lock && systemctl suspend-then-hibernate"
exec --no-startup-id /usr/lib/polkit-kde-authentication-agent-1
exec_always --no-startup-id xmodmap ~/.Xmodmap
exec --no-startup-id ibus-daemon -drx
# Need the alpha option because wal doesn't remember it.
exec_always --no-startup-id wal -R -a 80
exec_always --no-startup-id killall picom; picom -b --experimental-backends
exec_always --no-startup-id killall dunst; dunst
exec_always --no-startup-id killall polybar; polybar main
exec --no-startup-id systemctl --user start wallplug.timer
exec --no-startup-id systemctl --user start battery-monitor.timer
exec --no-startup-id systemctl --user start mpd-notification.service

# Dropdown terminal.
exec --no-startup-id i3-sensible-terminal -t "dropdown"
for_window [title="dropdown"] move scratchpad
for_window [title="dropdown"] sticky enable

# Disable inactive transparency for current window.
bindsym $mod+t exec picom-trans -c 100
