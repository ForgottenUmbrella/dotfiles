# Use the base i3 config.
include "$XDG_CONFIG_HOME/i3/config"

# Aesthetics.
output * bg "$wallpaper" fill
# XXX: Once the shader backend is implemented, use rounded corners.
border_images.focused "$XDG_CONFIG_HOME/sway/borders/shadows.png"
border_images.focused_inactive "$XDG_CONFIG_HOME/sway/borders/shadows.png"
border_images.unfocused "$XDG_CONFIG_HOME/sway/borders/shadows.png"
border_images.urgent "$XDG_CONFIG_HOME/sway/borders/shadows.png"

# IO.
input type:keyboard {
    xkb_layout us,us
    xkb_variant colemak,
    xkb_options ctrl:nocaps,compose:menu
}
input 65261:4871:ZSA_Ergodox_EZ {
    xkb_layout us
    xkb_variant ""
    xkb_options compose:menu
}

input type:touchpad {
    dwt enabled
    tap enabled
    natural_scroll enabled
    middle_emulation enabled
}

# Bar.
bar {
   swaybar_command waybar
}

# Application configuration.
for_window [app_id=zoom] {
    exec pa_volume 'ZOOM VoiceEngine' 100
    inhibit_idle focus
    # XXX: Maybe enable this?
    # floating enable
}
# Stupid thing opens in occcupied workspace, crashing.
for_window [title="Zoom Meeting|Webinar"] floating enable
for_window [app_id=totem] inhibit_idle focus
# Keep marked windows opaque.
for_window [con_mark="opaque"] opacity 1

# Custom bindings.
bindsym $mod+Ctrl+space exec ime-menu
bindsym --no-warn $mod+space input * xkb_switch_layout next

# Sway-specific autostart.
exec /usr/share/sway/scripts/inactive-windows-transparency.py
exec swayidle -w \
   timeout 300 lock \
   timeout 330 'swaymsg "output * dpms off"' \
   resume 'swaymsg "output * dpms on"' \
   timeout 900 'systemctl suspend-then-hibernate' \
   before-sleep 'loginctl lock-session' \
   # after-resume 'swaymsg "output * dpms on' \
   lock lock \
   # unlock 'swaymsg "output * dpms on"'
# GTK on Wayland ignores the settings.ini file, so load it yourself.
exec "$XDG_CONFIG_HOME/sway/import-gsettings.sh" \
    gtk-theme:gtk-theme-name \
    icon-theme:gtk-icon-theme-name \
    cursor-theme:gtk-cursor-theme-name
# Needed for screen sharing for now (https://bugs.archlinux.org/task/72297).
# Needed for Java applications (https://github.com/swaywm/sway/issues/595).
exec_always dbus-update-activation-environment --systemd \
    XDG_CURRENT_DESKTOP=sway \
    _JAVA_AWT_WM_NONREPARENTING=1

# Distro-specific package fixes and system-wide config.
include /etc/sway/config.d/*
